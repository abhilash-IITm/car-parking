<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard | Vehicle Parking App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
</head>
<body>

<header>
    <div class="profile-pic">
        {{ username[0] | upper }}
    </div>
    <div class="profile-details">
        <div class="profile-name">{{ name }}</div>
        <div class="profile-username">@{{ username }}</div>
    </div>
    <a class="logout-button" href="{{ url_for('auth.logout') }}">logout</a>
</header>

<main>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash">{{ messages[0] }}</div>
        {% endif %}
    {% endwith %}
    <section class="search-spot-section">
        <form method="GET" action="{{ url_for('admin.search_spot') }}" class="search-spot-form">
            <input 
                type="number" 
                name="spot_id" 
                placeholder="Enter Spot ID to search" 
                min="1" 
                required 
                value="{{ searched_spot.spot_id if searched_spot else '' }}"
            />
            <button type="submit">Search Spot</button>
        </form>
    </section>

    
    <section class="analytics" aria-label="Parking analytics summary">
        <div class="analytic-item">
            <h3>{{ spots_occupied }}</h3>
            <p>Spots Occupied</p>
        </div>
        <div class="analytic-item">
            <h3>{{ occupancy_percent }}%</h3>
            <p>Occupied Percentage</p>
        </div>
        <div class="analytic-item">
            <h3>{{ revenue_per_minute }}</h3>
            <p>Revenue / Minute</p>
        </div>
    </section>

    
    <section class="parking-spots-grid" aria-label="Grid of parking lots and occupancy">
        {% for lot in parking_lots %}
        <a href="{{ url_for('admin.lot_list', lot_id=lot.id) }}" class="parking-spot-card-link" aria-label="View details of {{ lot.location_name }}">
            <article class="parking-spot-card">
                <div class="parking-spot-title">{{ lot.location_name }}</div>
                <div class="parking-spot-subtitle">{{ lot.pin_code }}</div>
                <div class="parking-spot-occupancy">
                    {{ lot.occupied }} / {{ lot.max_spots }} Spots occupied
                </div>
            </article>
        </a>
        {% else %}
        <p>No parking lots available.</p>
        {% endfor %}
    </section>

    {% if pie_img %}
    <section class="dashboard-charts">
        <h3 style="color:#136b25;">Occupied Spots Distribution</h3>
        <img src="data:image/png;base64,{{ pie_img }}" alt="Pie chart: occupied spots"/>
    </section>
    {% endif %}

    {% if bar_img %}
    <section class="dashboard-charts">
        <h3 style="color:#136b25;">Revenue by Lot</h3>
        <img src="data:image/png;base64,{{ bar_img }}" alt="Bar chart: lot revenues"/>
    </section>
    {% endif %}


    
    <div class="dashboard-bottom-buttons">
        <a href="{{ url_for('admin.parking_history')}}" class="create-lot-button">view parking history</a>
        <a href="{{ url_for('admin.view_users') }}" class="create-lot-button">View Users</a>
        <a href="{{ url_for('admin.create_parking_lot') }}" class="create-lot-button">Create Parking Lot</a>
    </div>
</main>

</body>
</html>
